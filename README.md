**Разворачиваем сетевую лабораторию**

**1. Описание задания**

**Теоретическая часть**  

Найти свободные подсети, посчитать сколько узлов в каждой подсети, включая свободные, указать broadcast адрес для каждой подсети, проверить нет ли ошибок при разбиении.  

**Практическая часть**  

Соединить офисы в сеть согласно схеме и настроить роутинг. Все сервера и роутеры должны ходить в инет черз inetRouter. Все сервера должны видеть друг друга. У всех новых серверов отключить дефолт на нат (eth0), который вагрант поднимает для связи. При нехватке сетевых интервейсов добавить по несколько адресов на интерфейс.

Вводные данные:  

В виртуальной среде виртуалбокc при помощи вагрант файл разварачиваю несколько виртуальных хостов, часть из них будут являться маршутизаторами: inetRouter, centralRouter, office1Router, office2Router, часть из них будут являться серверами: centarlServer, office1Server, office2Server.

Планируемая архитектура.  

Сеть inetRouter.  
10.0.2.15/24 - интеренет  
192.168.255.1/30 - локальная сеть  

Сеть centralRouter.  
192.168.0.0/28 - directors  
192.168.0.32/28 - office hardware  
192.168.0.64/26 - wifi  
192.168.255.0/30 локальная сеть  

Сеть office1.  
192.168.2.0/26 - dev  
192.168.2.64/26 - test servers  
192.168.2.128/26 - managers  
192.168.2.192/26 - office hardware  

Сеть office2.  
192.168.1.0/25 - dev  
192.168.1.128/26 - test servers  
192.168.1.192/26 - office hardware 

```
Office1 ---\
----> Central --IRouter --> internet
Office2----/
```


 **2. Выполенение задания.**

 **Теоритическая часть.**
 
1. Ориентируясь на вводные данные, вижу, что есть сеть directors 192.168.0.0/28
192.168.0.0 — это сама сеть, 28 — это маска. Маска отмечает, границы сети 192.168.0.0. Маска может быть записана в 2-х видах:  /28 или 255.255.255.240.
   
Пример перевода маски /28 в формат 255.255.255.240:

Маска Ipv4-адреса — это 4 октета, т.е. 4 блока по 8 цифр (1 или 0). 
/28 — это 28 единиц с начала маски: 11111111.11111111.11111111.11110000  
Всегда при разбиении сетей, после знака / указывается количество единиц с начала маски.

11111111.11111111.11111111.11110000 — это двоичный код маски, если мы переведем данное значение в десятичную систему счисления, то получим 255.255.255.240

2. Далее посчитал количество устройств в сети: 
Количество устройств в сети рассчитывается по формуле = 2^(32−маска)−2.
Таким образом, количество устройств для подсети /28 будет = 2^(32−28)−2=16−2=14.

Цифра 2 вычитается, так как:
Первый адрес (192.168.0.0) — это наименование подсети, его нельзя задать устройству.  
Последний адрес (192.168.0.15) — это всегда broadcast-адрес. Broadcast-адрес нужен для рассылки всем устройствам сети. 

3. Таким образом для сети 192.168.0.0/28 исходя из вычислений выше мы будем иметь следующие:
```
   Сеть           Маска           Кол-во адресов  Первый адрес в сети  Последний адрес в сети  Broadcast — адрес
   192.168.0.0/28 255.255.255.240 14              192.168.0.1          192.168.0.14            192.168.0.15
```
4. По такому же принцыпу посчитал сколько узлов в каждой подсети, включая свободные, broadcast адрес для каждой подсети, первый и последний адрес в сети.
   Полученные данный для каждой подсети свел в таблицу ниже.
   
```
Сеть             Маска            Кол-во адресов  Первый адрес в сети  Последний адрес в сети  Broadcast — адрес

Central Network
192.168.0.0/28   255.255.255.240  14              192.168.0.1          192.168.0.14            192.168.0.15
192.168.0.32/28  255.255.255.240  14              192.168.0.33         192.168.0.46            192.168.0.47
192.168.0.64/26  255.255.255.192  62              192.168.0.65         192.168.0.126           192.168.0.127

Office 1 network
192.168.2.0/26   255.255.255.192  62              192.168.2.1          192.168.2.62            192.168.2.63
192.168.2.64/26  255.255.255.192  62              192.168.2.65         192.168.2.126           192.168.2.127
192.168.2.128/26 255.255.255.192  62              192.168.2.129        192.168.2.190           192.168.2.191
192.168.2.192/26 255.255.255.192  62              192.168.2.193        192.168.2.254           192.168.2.255

Office 2 network
192.168.1.0/25   255.255.255.128  126             192.168.1.1          192.168.1.126           192.168.1.127
192.168.1.128/26 255.255.255.192  62              192.168.1.129        192.168.1.190           192.168.1.191
192.168.1.192/26 255.255.255.192  62              192.168.1.193        192.168.1.254           192.168.1.255

InetRouter — CentralRouter network
192.168.255.0/30 255.255.255.252  2               192.168.255.1        192.168.255.2           192.168.255.3
```
5. Ошибок в задании нет, также вижу следующие свободные сети:
   
192.168.0.16/28  
192.168.0.48/28  
192.168.0.128/25  
192.168.255.64/26  
192.168.255.32/27  
192.168.255.16/28  
192.168.255.8/29  
192.168.255.4/30 



 **Практическая часть.**  
 
 В ручном режиме подключаясь по ssh  сконфигурировал узыл.
 
1. inetRouter
- настроил ipforwarding
- настроил NAT
- настроил обратный маршрут для пересылки с ната в локалку.

2. centralRouter
- отключил дефолтный маршрут на eth0
- включил дефолтный маршрут на eth1 192.168.255.1
- настроил ipforwarding

3. centarlServer
- отключил дефолтный маршрут на eth0
- включил дефолтный маршрут на eth1 192.168.0.1

4. office1Router
- отключил дефолтный маршрут на eth0
- включил дефолтный маршрут на eth1 192.168.255.9
- настроил ipforwarding

5. office2Router
- отключил дефолтный маршрут на eth0
- включил дефолтный маршрут на eth1 192.168.255.5
- настроил ipforwarding

6. office1Server
- отключил дефолтный маршрут на eth0
- включил дефолтный маршрут на eth1 192.168.2.1

7. office2Server
- отключил дефолтный маршрут на eth0
- включил дефолтный маршрут на eth1 192.168.1.1

Используюя команду `traceroute 8.8.8.8` проверил работу интернета на хосте office1Server, вывод команды ниже.
```
root@office1Server:~# traceroute 8.8.8.8
traceroute to 8.8.8.8 (8.8.8.8), 30 hops max, 60 byte packets
 1  _gateway (192.168.2.129)  1.736 ms  1.587 ms  1.524 ms
 2  192.168.255.9 (192.168.255.9)  2.052 ms  1.943 ms  1.862 ms
 3  192.168.255.1 (192.168.255.1)  4.252 ms  3.549 ms  3.197 ms
 4  * * *
 5  * * *
 6  * * *
 7  * * *
 8  77.37.250.221 (77.37.250.221)  7.821 ms  5.616 ms  5.558 ms
 9  77.37.250.249 (77.37.250.249)  5.530 ms  6.958 ms  6.913 ms
10  72.14.209.81 (72.14.209.81)  6.878 ms  6.842 ms  6.954 ms
11  * * *
12  108.170.250.129 (108.170.250.129)  7.244 ms 108.170.250.33 (108.170.250.33)  7.180 ms 108.170.250.129 (108.170.250.129)  7.151 ms
13  108.170.250.51 (108.170.250.51)  9.975 ms 108.170.250.113 (108.170.250.113)  9.927 ms 108.170.250.51 (108.170.250.51)  9.842 ms
14  142.251.49.24 (142.251.49.24)  18.530 ms  21.204 ms 216.239.51.32 (216.239.51.32)  25.922 ms
15  74.125.253.94 (74.125.253.94)  35.244 ms 172.253.66.110 (172.253.66.110)  48.365 ms 74.125.253.94 (74.125.253.94)  24.055 ms
16  142.250.238.181 (142.250.238.181)  24.700 ms 172.253.51.243 (172.253.51.243)  33.739 ms 209.85.254.135 (209.85.254.135)  26.701 ms
17  * * *
18  * * *
19  * * *
20  * * *
21  * * *
22  * * *
23  * * *
24  * * *
25  * * *
26  * dns.google (8.8.8.8)  23.135 ms  24.084 ms
root@office1Server:~# 
```

8. Убедившись в правильности ручной настройки, отобразил её в вагрант файле. 
9. Написал отчет на гитхабе, загрузил в репозиторий вагрантфайл. 
